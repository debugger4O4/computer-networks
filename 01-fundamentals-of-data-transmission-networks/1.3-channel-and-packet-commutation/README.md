## Глава 3. Коммутация каналов и пакетов.
При решении задачи коммутации аббонентов в сетях выделяют **коммутацию каналов** и **коммутацию пакетов**. Каждый имеет
достоинства и недостатки.<br>
Коммутация пакетов - более эффективена для компьютерных сетей, так как учитываются особенности трафика.<br>
Коммутация каналов - более эффективена для телефонных сетей.
### Коммутация каналов.
Сеть коммутации каналов - множество коммутаторов и конечных узлов - абонентов, соединненых между собой линиями(звеньями)
связи.<br>
Сеанс связи - время существования информационного потока.
### Элементарный канал.
**Элементарный канал** - базовая характеристика сети с коммутацией каналов. Фиксированное в пределах данного типа сетей 
значение пропускной способности. Любая линия связи в сети с коммутацией аналов имеет пропускную способность, кратную
элементарному каналу, принятому для данного типа сети.<br>
Значение элементарного канала в современных телефонных сетях = `64 Кбит/с` - минимальная достаточная скорость для качественной
цифровой передачи голоса.<br>
Особенностью сетей с коммутацией каналов является то, что пропускная способность каждой линии связи должна быть равна
целому числу элементарных каналов.
**Оцифровывание голоса.**
<br><img alt="img.png" height="200" src="content%2Fimg.png" width="300"/><br>
*Дискретизация по времени* происходит за счет измерения амплитуды исходной непрерывной функции с заданным периодом -> 
*дискретизация по значению* - каждый замер представляется в виде двоичного числа определенной разрядности.

Частота квантоавния амплитуды звуковых колебаний для качественной передачи голоса = `8000 Гц`.
Амплитуда одного замера = `8 бит` -> `256` градаций звукового сигнала.
В этом случае для передачи одного голосового канала пропускная способность = `64 Кбит/c` (`8000 * 8 = 64000 бит/c` или `64 Кбит/c`) - 
**элементарный канал цифровы телефонных сетей**.
<br><img alt="img1.png" height="200" src="content%2Fimg1.png" width="300"/><br>
Сеть характеризуется элементарным каналом `T бит/с`.<br>
Линии связи с разной пропускной способностью = `[2, 3, 4, 5]` элементарных каналов.<br>
Предположим, что элементарные каналы дуплексные, идентифицируются номерами.<br>
Коммутатор `S2` имеет на интерфейсе (порту) `P1` элементарные каналы `[1, 2, 3, 4]`, на `P3` `[1, 2, 3, 4, 5]`.<br>
`A`, `B` - абоненты. Маршрут информационного потока во время сеанса связи = `[S1, S2, S3, S4]`.<br>
Предположим, что интенсивность информационного потока между абонентами `<= 2 Tбит/c`.<br>
Итог - для обмена данными между `А` и `B` достаточно иметь в своем распоряжении по паре элементарных каналов, выделенных
из каждой линии связи, лежащей на маршруте.
### Составной канал.
**Составной канал** - канал, построенный путем коммутации (соединения) выделенных для информационного потока элементарных
каналов.<br>
Свойства составного канала:
- на всем своем протяжении состоит из одинакового количества элементарных каналов;
- на всем своем протяжении имеет постоянную и фиксированную пропускную способность;
- создается на время существования потока;
- все входящие в состав элементарные каналы на время сеанса связи поступают в исключительное пользование абонентов;
- абоненты в течение всего сеанса связи могут посылать в сеть данные со соростью <= пропускной способности;
- поступившие данные гарантированно доставляются абоненту без потерь, задержек и с той же скоростью вне зависимоти от других
соединений;
- после окончания сенса связи элементарные каналы освобождаются и возвращаются в пул распределяемых ресурсов.

**Процедура установления соединения** - отправка запроса в коммутационную сеть с сообщением и адресом вызываемого абонента.
Цель - проверить, можно ли образовать составной канал между вызывающим и вызываемым абонентом. Используется в мультиплексировании
каналов, потому что абоненты вынуждены конкурировать за ресурсы. Возможны ситуации, когда некоторая промежуточная линия 
связи исчерпала свободные элементарные каналы - новый сеанс связи, пролегающий через данную линию, может не состояться.<br>
Марщруты определяются заранее в глобальных таблицах коммутации.
<br><img alt="img2.png" height="200" src="content%2Fimg2.png" width="300"/><br>
<br><img alt="img3.png" height="200" src="content%2Fimg3.png" width="300"/><br>
Этапы продвижения данных в сетях с коммутацией каналов:
1. В сеть поступает служебное сообщение - запрос, который несет адрес вызываемого абонента и инициирует создание составного
канала.
2. По подготовленному составному каналу передается основной поток данных, для передачи которого не требуется никакой вспомогательной
информации. Коммутация данных в коммутаторах выполняется на основании номеров выделенных элементарных каналов.
<br><img alt="img4.png" height="200" src="content%2Fimg4.png" width="300"/><br>
<br><img alt="img5.png" height="200" src="content%2Fimg5.png" width="300"/><br>
### Неэффективность передачи пульсирующего трафика.
**Пульсирующий** характер данных - измение темпа речи, паузы - потоки данных не равномерны, снижается эффективность 
передачи. Для телефонного разговора это приемлимо, для компьютеров - нет. Снижается эффективность сети. Для эффективной
передачи компьютерного трафика используют коммутацию пакетов.
### Коммутация пакетов.
**Пакеты** - представление информации, передаваемой по сети, в виде структурно отделенных друг от друга порций данных.<br>
Каждый пакет снабжен **заголовком** - содержит адрес назначения и вспомогательную информацию, **концевиком** - содержит
контрольную сумму, которая позволяет проверить, были ли искажена информация при передаче через сеть.
<br><img alt="img6.png" height="200" src="content%2Fimg6.png" width="300"/><br>
<br><img alt="img7.png" height="200" src="content%2Fimg7.png" width="300"/><br>
### Буферизация пакетов.
Главное отличие пакетных коммутаторов от коммутаторов в сетях с коммутацией каналов в том, что они имеют внутреннюю буферную
память для временного хранения пакетов.<br>
Пакетный коммутатор:<br>
Проверка контрольной суммы -> Если валидно, то -> Обработка пакета, определние следующего коммутатора.
<br><img alt="img8.png" height="200" src="content%2Fimg8.png" width="300"/><br>
Объем буфера в коммутаторах ограничен. Иногда происходит потеря пакетов из-за переполнения буферов при временной перегрузке
части сети (Совпадают периоды пульсации нескольких информационных потоков).<br>
Пакетный коммутатор может работать на основании одного из трех методов продвижения пакетов:
- дейтаграммная передача;
- передача с установлением логического соединения;
- передача с установлением виртуального канал.

### Дейтаграммная передача.
**Дейтаграммный способ передачи данных** - все передаваемые пакеты продвигаются независимо друг от друга на основании одних
и тех же правил. Информация об уже переданных пакетах сетью не хранится и не принимается в ходе обработки очередного пакета.
**Дейтаграмма** - пакет, независимая единица передачи.
<br><img alt="img9.png" height="200" src="content%2Fimg9.png" width="300"/><br>
В дейтаграмном методе доставка пакета не гарантируется, а выполняется по мере возможности - для описания такого свойства
используется термин **доставка по возможности (best effort)**.
### Передача с установлением логического соединения.
**Установление логического соединения** - процедура согласования двумя конечными узлами сети некоторых параметров процесса
обмена пакетами.<br>
**Параметры логического соединения** - параметры, о кото6рых договариваются два взаимодействующих узла.<br>
Три фазы передачи с установлением логического соединения:
- *Установление логического соединения*. Узел-инициатор соединения отправляет узлу-получателю служебный пакет с предложением
установить соединение -> Если узел-получатель согласен, то -> Узел-получатель посылает сигнал в другой служебный пакет ->
Служебный пакет подтверждает установление соединения, предлагает некоторые параметры для использования. Узел-инициатор
может закончить процесс установления соединения отправкой третьего служебного пакета, в котором сообщит, что параметры ему
подходят.
<br><img alt="img10.png" height="200" src="content%2Fimg10.png" width="300"/><br>
- *Передача данных*. Логическое соединение может быть рассчитано на передачу данных как в одном направлении, так и в обоих
направлениях.
- *Разрыв логического соединения*. Происходит после операции передачи законченного набора данных.

### Передача с установлением виртуального канала.
**Виртуальный канал** (virtual circuit, virtual channel) - заранее проложенный фиксированный маршрут, соединяющий конечные
узлы в сети с коммутацией пакета.<br>
С целью выделения потока данных из общего трафика каждый пакет этого потока помечается признаком особого вида - **меткой**.
<br><img alt="img11.png" height="200" src="content%2Fimg11.png" width="300"/><br>
### Сравнение сетей с коммутацией пакетов и каналов.
<br><img alt="img12.png" height="200" src="content%2Fimg12.png" width="300"/><br>
### Транспортная аналогия для сетей с коммутацией пакетов и каналов.
Автомобиль - пакет.<br>
Дорога - канал.<br>
Перекресток - коммутатор.<br>
### Структура задержек в сетях с коммутацией каналов.
<br><img alt="img13.png" height="200" src="content%2Fimg13.png" width="300"/><br>
`T = tprg + ttrns`.<br>
`T` - время доставки данных адресату.<br>
`tprg` (prg - propagation) - время распространения сигнала.<br>
`ttrns` (trns - transmission) - время передачи сообщения в канал (время сериализации).<br>

`tprg = L / S`.<br>
`L` - расстояние между абонентами.<br>
`S` - скорость распространения электромагнитных волн в конкретной физической среде, которая колеблется от `0.6` до `0.9`
скорости света в вакууме.<br>

`ttrns = V / C`.<br>
`V` - объем сообщения в битах.<br>
`C` - пропускная способность в битах в секнду.<br>
<br><img alt="img14.png" height="200" src="content%2Fimg14.png" width="300"/><br>
Факты при сравнение передачи данных с коммутацией каналов и пакетов:
- `tprg` в одинаковой физической среде на одно и тоже расстояние одинаковы;
- `ttrns` равны при одинаковой пропускной способности.

<br><img alt="img15.png" height="200" src="content%2Fimg15.png" width="300"/><br>
Время передачи одного пакета от узла `N1` до коммутатора `1` = сумма нескольких слагаемых.<br>
- Время тратися в узле-отправителе `N1`:
  - `t1` - время формирования пакета (пакетизация);
  - `t2` - время передачи в канал заголовка;
  - `t3` - время передачи в канал поля данных пакета;
- Дополнительное время тратится на распространение сигналов по каналам связи. `t4` - время распространения сигнала (1 бит
информации) от узла `N1` до коммутатора `1`.
- Дополнительное время тратися в промежуточном коммутаторе:
  - `t5` - время приема пакета с его заголовком из канала во входной буфер коммутатора (`t2 + t3`);
  - `t6` - время ожидания пакета в очереди.
  - `t7` - время коммутации пакета при его передаче в выходной порт.

`T_N1-S1 = t1 + t4 + t5 + t6 + t7`.<br>
`T_N1-S1` - время передачи пакета из узла `N1` на выходной интерфейс коммутатора `1`.<br>
`t2` и `t3` отсутствуют - передача битов из передатчика в канал совмещается по времени с передачей битов по каналу связи.<br>

`T1 = T_N1-S1 + T_S1-S2 + T_S2-N2`.<br>
`T1` - полное время передачи одного пакета.
`T_S1-S2, T_S2-N2` (аналогично `T_N1-S1`, но не входит время пакетизации) - время на оставшиеся два отрезка пути.<br>

`T_PS = T1 + (n - 1)(t1 + t5)`.<br>
`T_PS` - время передачи сообщенияя, состоящего из `n` пакетов.

### Количественное сравнение задержек. Пример.
- `V = 10^7 байт`, где `V` - объем сообщения, передаваемого в обоих видах сетей;
- `L = 5000 км`, где `L` - расстояние между `N1` и `N2`;
- `S = 200000 км/с (2/3 скорости света)`, где `S` - скорость распространения сигнала;
- `C = 100 Мбит/c`, где `C` - пропускная способность линий связи.

*Время передачи данных по сети с коммутацией каналов* = время распространения сегнала + время передачи сообщения в канал.<br>
Предположительно канал постоянный.<br>
*Время распространения сигнала* = `L / S = 0.025 с` (`25 мс`).<br>
*Время передачи сообщения в канал* = `(V * 8 бит)/C` (`10^8 бит/с`) = `8 * 10^-1 = 0.8(с) = 800 мс`.<br>

